#_______________________________________________________________________________________________
#
#    				Start R ----
#
#_______________________________________________________________________________________________
#Rouge : #B11116
#Bleu : #0066CC
#Violet : #581874
#-------------------- Delete all
rm(list=ls(all=TRUE))
#-------------------- library
library(shiny)
library(dplyr)
#-------------------- Directory
#directory		=	"C:\\Users\\rtabet\\Documents\\Projets\\BPCE RH ANALYTICS\\Work\\Shiny 3.0"
directory   =  "C:\\Users\\jchau\\Documents\\Projects\\BPCE- HR Analytics\\POC_RH_Analytics"
#directory   =  "C:\\Users\\rtabet\\Documents\\Projets\\BPCE RH ANALYTICS\\Work\\POC_RH_Analytics"
setwd(directory)
#_______________________________________________________________________________________________
#
#    				Load Data ----
#
#_______________________________________________________________________________________________
ptc=proc.time()
#Onglet 1 : effectifs a date
dat_dec2015			  =	readRDS("Data/dat_dec2015.RDS")
dat_dec2014			  =	readRDS("Data/dat_dec2014.RDS")
effectifs_12M=readRDS("Data/effectifs_12M.RDS")
Evol_flux_2014_2015=readRDS("Data/Evol_flux_2014_2015.RDS")
flux_dernier_trimestre=readRDS("Data/flux_dernier_trimestre.RDS")
Taux_survie=readRDS("Data/Taux_survie.RDS")
rr      = readRDS("Data/rr.RDS")
flux2     = readRDS("Data/mat_flux.RDS")
#Complement graphique prevision
Departs_2011_2015_Emploi      = readRDS("Data/Departs_2011_2015_Emploi.RDS")
Effectifs_2011_2016_Emploi      = readRDS("Data/Effectifs_2011_2016_Emploi.RDS")
Rec_Emploi_2011_2015      = readRDS("Data/Rec_Emploi_2011_2015.RDS")
dem_2011_2015_Emploi=data.frame(Departs_2011_2015_Emploi[,c("CIB_TYPE","Emploi_repere","nb_dem","annee")])
ret_2011_2015_Emploi=data.frame(Departs_2011_2015_Emploi[,c("CIB_TYPE","Emploi_repere","nb_ret","annee")])
#_______________________________________________________________________________________________
#
#      			List UI
#
#_______________________________________________________________________________________________
head(dat_dec2015)
list.Emploi   =   sort(sapply(split(dat_dec2015$nb_CIB,dat_dec2015$Emploi_repere),sum),decreasing=T)
list.Emploi   =   data.frame(Emploi_repere=names(list.Emploi[list.Emploi>30]))
zz            =   rr[,c("Emploi_repere","Emploi_repere_lib")]
list.Emploi  = merge(list.Emploi,zz,by="Emploi_repere",all.x=T,sort=F)
list.Emploi = arrange(list.Emploi,Emploi_repere_lib)
list.Emploi[,2]=as.character(list.Emploi[,2])
list.Emploi[list.Emploi[1]=='Total',2]='Total'
list.UI.emploi=list(label=as.character(list.Emploi[,2]),value=as.character(list.Emploi[,1]))
names(list.UI.emploi$value)=list.UI.emploi[[1]]
#_______________________________________________________________________________________________
#
#    				On compile les fonctions appel?es pour les pr?visions
#
#_______________________________________________________________________________________________
source("Fonctions_prevision4.R")
source ("previsions.R")
couleurbleu="#9BB1C4"   #"#8590C1""#1D376B"
couleurrouge="#F0C9C9"   #"#E09191" "#D90A18"
#_______________________________________________________________________________________________
#
#    				Specific separator ----
#
#_______________________________________________________________________________________________
highchartsPlot <- function(outputID, outputclass)
{div(id=outputID, class=outputclass);}
proc.time()-ptc
NintS <- function(x)
{formatC(x, format = "f", decimal.mark = ",", digits = 0, big.mark = " ")}
NrealS <- function(x)
{formatC(x, format = "f", decimal.mark = ",", digits = 2, big.mark = " ")}
#_______________________________________________________________________________________________
#
#        		FLux ----
#
#_______________________________________________________________________________________________
list.flux2  = c(sort(names(table(flux2[which(flux2$Flow1>15),'From']))),"Total")
list.flux2 =list.flux2 [-5]
#_______________________________________________________________________________________________
#
#          	Carto ----
#
#_______________________________________________________________________________________________
library(jsonlite)
#_______________________________________________________________________________________________
#
#      			Lancement App ----
#
#_______________________________________________________________________________________________
runApp()
rm(list=ls(all=TRUE))
#-------------------- library
library(shiny)
#-------------------- Directory
#directory  	=	"C:\\Users\\rtabet\\Documents\\Projets\\BPCE RH ANALYTICS\\Work\\Shiny 3.0"
directory   =  "C:\\Users\\jchau\\Documents\\Projects\\Lab\\layout_1\\LTR"
#directory   =  "C:\\Users\\rtabet\\Documents\\Projets\\BPCE RH ANALYTICS\\Work\\POC_RH_Analytics"
setwd(directory)
rm(list=ls(all=TRUE))
#-------------------- library
library(shiny)
#-------------------- Directory
#directory  	=	"C:\\Users\\rtabet\\Documents\\Projets\\BPCE RH ANALYTICS\\Work\\Shiny 3.0"
directory   =  "C:\\Users\\jchau\\Documents\\Projects\\Lab\\layout_1\\LTR"
#directory   =  "C:\\Users\\rtabet\\Documents\\Projets\\BPCE RH ANALYTICS\\Work\\POC_RH_Analytics"
setwd(directory)
runApp()
